<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="Author" content="Jan Burdzicki">

	<title>Leaderboard</title>

	<link rel="icon" type="image/svg+xml" href="/static/img/favicon/favicon.ico">
	<link rel="stylesheet" type="text/css" href="/static/css/style.css">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.8.2/css/all.css'>

	<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">

	<link href="https://fonts.googleapis.com/css?family=Lato|Poppins|Raleway|Roboto|
	Source+Sans+Pro|Ubuntu:300,400,500,600,700,800,900&display=swap&subset=latin-ext" rel="stylesheet">
</head>

<body>
	<div class="container">
		<div class="container__item landing-page-container">
			<div class="content-wrapper">

				<div class="wrapper">
					<nav class="navigation">
						<span id="brand">
							<a href="/">
								<img src="/static/img/logo/LogoNoBackground.png" width="70vmin" alt="">
								<p>SUSTAINABLE GARDEN</p>
							</a>
						</span>

                        <ul id="menu">
                            <li><a href="/profile/badges" class="cool-link">Badges</a></li>
                            <li><a href="/profile/stats" class="cool-link">Statistics</a></li>
                            <li><a href="/profile/leaderboard" class="cool-link">Leaderboard</a></li>
                            <li><a href="/profile" class="cool-link">Awa</a></li>
                        </ul>
					</nav>
				</div>

				<div class="l-wrapper" id="wrapper"></div>
				<!-- <div class="c-drawer" id="drawer"> -->
				<!-- <div class="c-swipe-zone" id="swipeZone"></div> -->
				<!-- <div class="c-drawer__handle"></div> -->
				<!-- <h4>Settings</h4><button class="c-toggle" id="test"> -->
				<!-- <div class="c-toggle__handle"></div> -->
				<!-- </button> -->
				<!-- </div> -->

				<footer class="footer">
					<h1 class="footing footer__item">
						Collabathon 2023
					</h1>
					<h1 class="footing footer__item">
						âœ¨ðŸŒŸðŸ’–ðŸ’ŽðŸ¦„ðŸ’ŽðŸ’–ðŸŒŸâœ¨ðŸŒŸðŸ’–ðŸ’ŽðŸ¦„ðŸ’ŽðŸ’–ðŸŒŸâœ¨
					</h1>
				</footer>
			</div>
		</div>
	</div>

	<script>
		console.clear();

		// Containers
		const wrapper = document.getElementById('wrapper');
		const header = document.getElementById('header');
		const drawer = document.getElementById('drawer');
		const swipeZone = document.getElementById('swipeZone');

		// Create Element
		const createNode = element => {
			return document.createElement(element)
		}

		// Append Element
		const append = (parent, el) => {
			return parent.appendChild(el);
		}

		// Toggle Drawer

		const closeDrawer = () => {
			document.querySelector('.c-overlay').style.opacity = 0;
			drawer.classList.remove('c-drawer--open');
			setTimeout(() => {
				document.querySelector('.c-overlay').remove();
			}, 50)
		}

		const openDrawer = () => {
			let newOverlay = createNode('div');
			newOverlay.classList = 'c-overlay';
			newOverlay.style.opacity = 0;
			newOverlay.addEventListener('click', closeDrawer);
			append(document.body, newOverlay);
			setTimeout(() => {
				newOverlay.style.opacity = 1;
				drawer.classList.add('c-drawer--open');
			}, 100)
		}

		const toggleDrawer = () => {
			drawer.classList.contains('c-drawer--open') ?
				closeDrawer() :
				openDrawer();
		}

		// Render Empty State
		const emptyState = () => {
			const newText = createNode('div');
			newText.classList = 'c-empty-state';
			newText.innerHTML = `
		<svg class="c-empty-state__icon" viewBox="0 0 24 24" width="48" height="48" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
			<line x1="12" y1="2" x2="12" y2="6"></line>
			<line x1="12" y1="18" x2="12" y2="22"></line>
			<line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
			<line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
			<line x1="2" y1="12" x2="6" y2="12"></line>
			<line x1="18" y1="12" x2="22" y2="12"></line>
			<line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
			<line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
		</svg>
		<div style="margin-top: 8px;">Loading...</div>
	`;
			append(wrapper, newText);
			setTimeout(() => {
				newText.remove();
			}, 500)
		}

		// Render Standings
		const renderList = (year) => {
			// const url = `https://ergast.com/api/f1/${year}/PersonStandings.json`; // TODO:
			const url = `/static/data/leaderboard.json`; // TODO:
			emptyState();
			fetch(url)
				.then(response => {
					return response.json()
				})
				.then(data => {
					const tableClass = 'c-table';
					let table = createNode('table');
					table.classList = tableClass;
					const tableContainer = document.querySelector(tableClass);
					table.innerHTML = `
			<thead class="c-table__head">
				<tr class="c-table__head-row">
					<th class="c-table__head-cell u-text--center">Place</th>
					<th class="c-table__head-cell">Person</th>
					<th class="c-table__head-cell u-text--right">Points</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		`;
					const title = createNode('div');
					title.classList = 'c-headline';
					title.innerHTML = `<h4 class="c-headline__title"><small class="u-text--danger">Challenge</small><br />Standings <small class="u-text--secondary">(${year == 'current' ? new Date().getFullYear() : year})</small></h4><span class="c-chip ${year == 'current' ? 'c-chip--success' : 'c-chip--secondary'}">Challenge ${year == 'current' ? 'in Progress' : 'Completed'}</span>`;
					append(wrapper, title);
					append(wrapper, table);
					data.MRData.StandingsTable.StandingsLists[0].PersonStandings.forEach(item => {
						const tableBody = table.querySelector('tbody');
						let tr = createNode('tr');
						tr.classList = "c-table__row";
						tr.innerHTML = `
						<td class="c-table__cell c-table__cell--place u-text--center"><span class="c-place">${item.position}</span></td>
					<td class="c-table__cell c-table__cell--name">${item.Person.givenName} ${item.Person.familyName}<br><small style="opacity: .4;">${item.Country[0].name}</small></td>
					<td class="c-table__cell c-table__cell--points u-text--right"><strong>${item.points}</strong></td>
				`;

						if (item.position == 1) {
							tr.querySelector('.c-place').classList.add('c-place--first');

							if (year != 'current') {
								const firstPlaceCard = createNode('div');
								firstPlaceCard.classList = 'c-winner';
								firstPlaceCard.innerHTML = `
							<div class="c-winner__image">
								<svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
									<circle cx="12" cy="8" r="7"></circle>
									<polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
								</svg>
							</div>
							<div class="c-winner__content">
								<small class="c-winner__badge">winner</small>
								<h5 class="c-winner__title">${item.Person.givenName} ${item.Person.familyName}</h5>
								<div class="c-winner__info">
									<small class="c-winner__info-item"><strong>${item.Country[0].name}</strong></small>
									<small class="c-winner__info-item">Points: <strong>${item.points}</strong></small>
								</div>
							</div>
						`;
								table.parentNode.insertBefore(firstPlaceCard, table)
								console.log('sup');
							}

						} else if (item.position == 2) {
							tr.querySelector('.c-place').classList.add('c-place--second');
						} else if (item.position == 3) {
							tr.querySelector('.c-place').classList.add('c-place--third');
						}
						append(tableBody, tr);
					})

				})
				.catch(err => {
					console.log(err)
				})
		}

		// // Theme toggle
		// document.getElementById('test').addEventListener('click', () => {
		// 	document.documentElement.classList.toggle('theme--dark')
		// 	document.getElementById('test').classList.toggle('c-toggle--active')
		// })

		// Create season select
		const createSeasonSelect = () => {
			const newSelect = createNode('div');
			newSelect.innerHTML = `
		<label class="c-field__label">Season:</label>
		<select class="c-field__input"></select>
	`;
			newSelect.classList = 'c-field';
			newSelect.style.position = 'relative';
			newSelect.style.zIndex = 300;
			let currentYear = new Date().getFullYear();
			for (let i = 0; i < 20; i++) {
				let itemYear = currentYear - i;
				let newOption = createNode('option');
				if (i == 0) {
					newOption.setAttribute('selected', true);
					newOption.innerHTML = `${itemYear} (current)`;
					newOption.setAttribute('value', 'current');
				} else {
					newOption.innerHTML = itemYear;
					newOption.setAttribute('value', itemYear);
				}
				append(newSelect.querySelector('.c-field__input'), newOption);
			}
			newSelect.querySelector('.c-field__input').addEventListener('change', (e) => {
				document.getElementById('wrapper').innerHTML = '';
				renderList(e.target.value);
				toggleDrawer();
			})
			append(drawer, newSelect);
		}

		// createSeasonSelect();

		renderList('current');

		// drawer.querySelector('.c-drawer__handle').addEventListener('click', toggleDrawer);
	</script>
</body>

</html>
